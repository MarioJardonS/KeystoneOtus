---
title: "Otus centrales de tomate según muestras divididas"
output: html_document
date: '2023-09-27'
---


```{r}

if (!require("BiocManager", quietly = TRUE))
    install.packages("BiocManager")
if (!require(vegan)) install.packages('vegan')
library(vegan)
if (!require(igraph)) install.packages('igraph')
library(igraph)
if (!require(apcluster)) install.packages('apcluster')
library(apcluster)
if (!require(plyr)) install.packages('plyr')
library(plyr)
if (!require(stringr)) install.packages('stringr')
library(stringr)
if (!require(phyloseq)) install.packages('phyloseq')
library(phyloseq)
if (!require(UpSetR)) install.packages('UpSetR')
library(UpSetR)

```


#Muestras divididas según desarrollo o no


```{r}
muestras_tomate <- c("desarrollo" , "no_desarrollo" , "totales")
```

```{r}
otus_tomate_desarrollo <- read.csv("../central_otus/otus_centrales_tomate_desarrollo" , row.names = 1)
otus_tomate_no_desarrollo <- read.csv("../central_otus/otus_centrales_tomate_no_desarrollo.csv" , row.names = 1)
otus_tomate_totales <- read.csv("../central_otus/reporte_tomate1.csv" , row.names = 1)

otus_centrales_tomate2 <- list(otus_tomate_desarrollo , otus_tomate_no_desarrollo , otus_tomate_totales)
```

```{r}
rizosfera_bacterias <- read.csv("../../data/taxonomy/linaje_bacterias.de_tomate.csv" , header = FALSE , sep = ";" , row.names = 1)
```

```{r}
taxa_centrales_tomate <- list()
for (i in 1:3){
  taxa_centrales_tomate[[i]] <- rizosfera_bacterias[intersect( row.names(rizosfera_bacterias), row.names(otus_centrales_tomate2[[i]])),]
  print( paste0( "Se obtuvieron "  , length(row.names(otus_centrales_tomate2[[i]])) , " OTUs centrales en las muestras de " , muestras_tomate[i] ) )
}

```



```{r}
nombres_familias <- c()
for (i in 1:3){
  nombres_familias <- union(nombres_familias ,as.vector(taxa_centrales_tomate[[i]][, "V7"]))
  
}


print(nombres_familias)
```

```{r}
data_familias <- matrix( nrow = length(nombres_familias), ncol = length(muestras_tomate) )



for (i in 1:3){
  for (j in 1:54) {
    if (is.element(nombres_familias[j], as.vector(taxa_centrales_tomate[[i]][, "V7"] ))){
      data_familias[j,i] <- 1
    }else
    {
      data_familias[j,i] <- 0
    }
  }
  
}


data_familias <- data.frame(data_familias , row.names = nombres_familias )
colnames(data_familias) <- c(  muestras_tomate)
```



```{r}
upset(data_familias    )
```

```{r}
nombres_generos <- c()
for (i in 1:3){
  nombres_generos <- union(nombres_generos ,as.vector(taxa_centrales_tomate[[i]][, "V8"]))
  #print(unique(as.vector(taxa_centrales_tomate[[i]][, "Rank5"])))
}
print(nombres_generos)
```


```{r}

data_generos <- matrix( nrow = length(nombres_generos), ncol = length(muestras_tomate) )



for (i in 1:3){
  for (j in 1:74) {
    if (is.element(nombres_generos[j], as.vector(taxa_centrales_tomate[[i]][, "V8"] ))){
      data_generos[j,i] <- 1
    }else
    {
      data_generos[j,i] <- 0
    }
  }
}


data_generos <- data.frame(data_generos , row.names = nombres_generos )
colnames(data_generos) <- c(  muestras_tomate)


```

```{r}
upset(data_generos)
```


```{r}
pares <- list(c(1,2) , c(1,3) , c(2,3))
for (i in 1:3){
  print(intersect(as.vector(taxa_centrales_tomate[[pares[[i]][1]]][ , "V9"]) , as.vector(taxa_centrales_tomate[[pares[[i]][2]]][ , "V9"]) ))
}
```

Entre las principales coincidencias entre los diversos Otus centrales de rizósfera de tomate se encuentran la abundancia del género Pseudomonas.

```{r}
print(taxa_centrales_tomate[[1]][ , c( "Rank7")])
```
```{r}
print(taxa_centrales_tomate[[2]][ , c( "Rank7")])
```


```{r}
data_tomate_desarrollo <- read.csv("../../data/tables/tomate_desarrollo.csv" , row.names = 1, header = TRUE )

medias <- c()
medianas <- c()
for (i in 1:dim(data_tomate_desarrollo)[2]){
  medias <- c(medias , mean(data_tomate_desarrollo[ , i]))
  medianas <- c(medianas , median(data_tomate_desarrollo[ , i]))
  }

data_tomate_desarrollo <- data_tomate_desarrollo[ row.names(otus_centrales_tomate2[[1]]),]
data_tomate_desarrollo <- rbind(medias , data_tomate_desarrollo)
data_tomate_desarrollo <- rbind(medianas , data_tomate_desarrollo)

row.names(data_tomate_desarrollo) <- c("Medianas" , "Medias" , row.names(otus_centrales_tomate2[[1]]))
head(data_tomate_desarrollo)
```

```{r}
data_tomate_no_desarrollo <- read.csv("../../data/tables/tomate_no_desarrollo.csv" , row.names = 1, header = TRUE )

medias <- c()
medianas <- c()
for (i in 1:dim(data_tomate_no_desarrollo)[2]){
  medias <- c(medias , mean(data_tomate_no_desarrollo[ , i]))
  medianas <- c(medianas , median(data_tomate_no_desarrollo[ , i]))
  }

data_tomate_no_desarrollo <- data_tomate_no_desarrollo[ row.names(otus_centrales_tomate2[[2]]),]
data_tomate_no_desarrollo <- rbind(medias , data_tomate_no_desarrollo)
data_tomate_no_desarrollo <- rbind(medianas , data_tomate_no_desarrollo)

row.names(data_tomate_no_desarrollo) <- c("Medianas" , "Medias" , row.names(otus_centrales_tomate2[[2]]))
head(data_tomate_no_desarrollo)
```


#Otus centrales según submuestreos aleatorios 



```{r}
otus_tomate_aleatorio1 <- list()

for (i in 1:10){
  otus_tomate_aleatorio1[[i]] <- read.csv( paste0("../central_otus/otus_centrales_tomate_aleatorio1_" , as.character(i) , ".csv" ) , row.names = 1)
}
```

La cantidad de OTUs detectados como clave en los submuestreos aleaorios se encuentra en un rango similar a la de los OTUs detectados con todas las muestras y con la primera división no aleatoria. 

```{r}
taxa_tomate_aleatorio1 <- list()
numero_otus <- c()
for (i in 1:10){
  taxa_tomate_aleatorio1[[i]] <- rizosfera@tax_table@.Data[row.names(otus_tomate_aleatorio1 [[i]]),]
  x_i <-  length(row.names(otus_tomate_aleatorio1[[i]]))
  print( paste0( "Se obtuvieron "  , as.character(x_i)  , " OTUs centrales en el submuestreo aleatorio " , as.character(i)  ) )
  numero_otus <- c(numero_otus , x_i)
}
print(paste0("Su media fue ", as.character(mean(numero_otus))))
print(paste0("Su mediana fue ", as.character(median(numero_otus))))
```

 

```{r}
nombres_familias <- c()
for (i in 1:10){
  nombres_familias <- union(nombres_familias ,as.vector(taxa_tomate_aleatorio1[[i]][, "Rank5"]))
  #print(unique(as.vector(taxa_centrales_tomate[[i]][, "Rank5"])))
}

nombres_familias <- union(nombres_familias , as.vector(taxa_centrales_tomate[[3]][,"Rank5"]))
print(nombres_familias)
```

```{r}
data_familias <- matrix( nrow = length(nombres_familias), ncol = 11 )



for (i in 2:11){
  for (j in 1:9) {
    if (is.element(nombres_familias[j], as.vector(taxa_tomate_aleatorio1[[i-1]][, "Rank5"] ))){
      data_familias[j,i] <- 1
    }else
    {
      data_familias[j,i] <- 0
    }
  }
}

for (j in 1:9) {
    if (is.element(nombres_familias[j], as.vector(taxa_centrales_tomate[[3]][, "Rank5"] ))){
      data_familias[j,1] <- 1
    }else
    {
      data_familias[j,1] <- 0
    }
}
data_familias <- data.frame(data_familias , row.names = nombres_familias )
colnames(data_familias) <- c("totales" , as.character(1:10) )
```



```{r}
upset(data_familias , nsets = 11 , keep.order = TRUE   )
```


```{r}
nombres_generos <- c()
for (i in 1:10){
  nombres_generos <- union(nombres_generos ,as.vector(taxa_tomate_aleatorio1[[i]][, "Rank6"]))
  #print(unique(as.vector(taxa_centrales_tomate[[i]][, "Rank5"])))
}

nombres_generos <- union(nombres_generos , as.vector(taxa_centrales_tomate[[3]][,"Rank6"]))
print(nombres_generos)
```

```{r}
data_generos <- matrix( nrow = length(nombres_generos), ncol = 11 )



for (i in 2:11){
  for (j in 1:94) {
    if (is.element(nombres_generos[j], as.vector(taxa_tomate_aleatorio1[[i-1]][, "Rank6"] ))){
      data_generos[j,i] <- 1
    }else
    {
      data_generos[j,i] <- 0
    }
  }
}

for (j in 1:94) {
    if (is.element(nombres_generos[j], as.vector(taxa_centrales_tomate[[3]][, "Rank6"] ))){
      data_generos[j,1] <- 1
    }else
    {
      data_generos[j,1] <- 0
    }
}
data_generos <- data.frame(data_generos , row.names = nombres_generos )
colnames(data_generos) <- c("totales" , as.character(1:10) )
```



```{r}
upset(data_generos , nsets = 11 , keep.order = TRUE   )
```





```{r}
for (i in 1:6){
  intersecion_i <- intersect(as.vector(taxa_tomate_aleatorio1[[i]][ , "Rank6"]) , as.vector(taxa_centrales_tomate[[3]][ , "Rank6"]  ) )
  print(paste0( "A nivel género hubo " , as.character( length(intersecion_i)) , " coincidencias entre los otus encontrados con todas las muestras y con el submuestreo aleatorio ", as.character(i) ))
}
```


```{r}
for (i in 1:6){
  intersecion_i <- intersect(as.vector(taxa_tomate_aleatorio1[[i]][ , "Rank7"]) , as.vector(taxa_centrales_tomate[[3]][ , "Rank7"]  ) )
  print(paste0( "A nivel especie´ hubo " , as.character( length(intersecion_i)) , " coincidencias entre los otus encontrados con todas las muestras y con el submuestreo aleatorio ", as.character(i) ))
}
```


