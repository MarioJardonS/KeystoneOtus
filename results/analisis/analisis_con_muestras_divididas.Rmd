---
title: "Otus centrales de tomate según muestras divididas"
output: html_document
date: '2023-09-27'
---


```{r}

if (!require("BiocManager", quietly = TRUE))
    install.packages("BiocManager")
if (!require(vegan)) install.packages('vegan')
library(vegan)
if (!require(igraph)) install.packages('igraph')
library(igraph)
if (!require(apcluster)) install.packages('apcluster')
library(apcluster)
if (!require(plyr)) install.packages('plyr')
library(plyr)
if (!require(stringr)) install.packages('stringr')
library(stringr)
if (!require(phyloseq)) install.packages('phyloseq')
library(phyloseq)
if (!require(UpSetR)) install.packages('UpSetR')
library(UpSetR)

```


#Muestras divididas según desarrollo o no


```{r}
muestras_tomate <- c("desarrollo" , "no_desarrollo" , "totales")
```

```{r}
otus_tomate_desarrollo <- read.csv("../central_otus/otus_centrales_tomate_desarrollo" , row.names = 1)
otus_tomate_no_desarrollo <- read.csv("../central_otus/otus_centrales_tomate_no_desarrollo.csv" , row.names = 1)
otus_tomate_totales <- read.csv("../central_otus/reporte_tomate1.csv" , row.names = 1)

otus_centrales_tomate2 <- list(otus_tomate_desarrollo , otus_tomate_no_desarrollo , otus_tomate_totales)
```

```{r}
rizosfera_bacterias <- read.csv("../../data/taxonomy/linaje_bacterias_standarizado.de_tomate.csv" , header = FALSE , sep = ";" , row.names = 1)
```

```{r}
taxa_centrales_tomate <- list()
for (i in 1:3){
  taxa_centrales_tomate[[i]] <- rizosfera_bacterias[intersect( row.names(rizosfera_bacterias), row.names(otus_centrales_tomate2[[i]])),]
  print( paste0( "Se obtuvieron "  , length(row.names(otus_centrales_tomate2[[i]])) , " OTUs centrales en las muestras de " , muestras_tomate[i] ) )
}

```



```{r}
nombres_familias <- c()
for (i in 1:3){
  nombres_familias <- union(nombres_familias ,as.vector(taxa_centrales_tomate[[i]][, "V7"]))
  
}
print(nombres_familias)
```

```{r}
data_familias <- matrix( nrow = length(nombres_familias), ncol = length(muestras_tomate) )



for (i in 1:3){
  for (j in 1:53) {
    if (is.element(nombres_familias[j], as.vector(taxa_centrales_tomate[[i]][, "V7"] ))){
      data_familias[j,i] <- 1
    }else
    {
      data_familias[j,i] <- 0
    }
  }
  
  }


data_familias <- data.frame(data_familias , row.names = nombres_familias )
colnames(data_familias) <- c(  muestras_tomate)
```

Pseudomonadaceae, Micrococcaceae y Mycobacteriaceae son las tres familias que se encontraron en los tres analisis.

```{r}
upset(data_familias    )
```

```{r}
nombres_generos <- c()
for (i in 1:3){
  nombres_generos <- union(nombres_generos ,as.vector(taxa_centrales_tomate[[i]][, "V8"]))
  #print(unique(as.vector(taxa_centrales_tomate[[i]][, "Rank5"])))
}
print(nombres_generos)
```


```{r}

data_generos <- matrix( nrow = length(nombres_generos), ncol = length(muestras_tomate) )



for (i in 1:3){
  for (j in 1:73) {
    if (is.element(nombres_generos[j], as.vector(taxa_centrales_tomate[[i]][, "V8"] ))){
      data_generos[j,i] <- 1
    }else
    {
      data_generos[j,i] <- 0
    }
  }
}


data_generos <- data.frame(data_generos , row.names = nombres_generos )
colnames(data_generos) <- c(  muestras_tomate)


```

Pseudomonas y Halopseudomonas fueron los géneros presentes en los tres análisis. 

```{r}
upset(data_generos)
```


```{r}
pares <- list(c(1,2) , c(1,3) , c(2,3))
for (i in 1:3){
  print(intersect(as.vector(taxa_centrales_tomate[[pares[[i]][1]]][ , "V9"]) , as.vector(taxa_centrales_tomate[[pares[[i]][2]]][ , "V9"]) ))
}
```

Entre las principales coincidencias entre los diversos Otus centrales de rizósfera de tomate se encuentran la abundancia del género Pseudomonas.

```{r}
print(taxa_centrales_tomate[[1]][ , c( "V9")])
```
```{r}
print(taxa_centrales_tomate[[2]][ , c( "V9")])
```
```{r}
print(taxa_centrales_tomate[[3]][ , c( "V9")])
```

```{r}
data_tomate_desarrollo <- read.csv("../../data/tables/tomate_desarrollo.csv" , row.names = 1, header = TRUE )

medias <- c()
medianas <- c()
for (i in 1:dim(data_tomate_desarrollo)[2]){
  medias <- c(medias , mean(data_tomate_desarrollo[ , i]))
  medianas <- c(medianas , median(data_tomate_desarrollo[ , i]))
  }

data_tomate_desarrollo <- data_tomate_desarrollo[ row.names(otus_centrales_tomate2[[1]]),]
data_tomate_desarrollo <- rbind(medias , data_tomate_desarrollo)
data_tomate_desarrollo <- rbind(medianas , data_tomate_desarrollo)

row.names(data_tomate_desarrollo) <- c("Medianas" , "Medias" , row.names(otus_centrales_tomate2[[1]]))
head(data_tomate_desarrollo)
```

```{r}
data_tomate_no_desarrollo <- read.csv("../../data/tables/tomate_no_desarrollo.csv" , row.names = 1, header = TRUE )

medias <- c()
medianas <- c()
for (i in 1:dim(data_tomate_no_desarrollo)[2]){
  medias <- c(medias , mean(data_tomate_no_desarrollo[ , i]))
  medianas <- c(medianas , median(data_tomate_no_desarrollo[ , i]))
  }

data_tomate_no_desarrollo <- data_tomate_no_desarrollo[ row.names(otus_centrales_tomate2[[2]]),]
data_tomate_no_desarrollo <- rbind(medias , data_tomate_no_desarrollo)
data_tomate_no_desarrollo <- rbind(medianas , data_tomate_no_desarrollo)

row.names(data_tomate_no_desarrollo) <- c("Medianas" , "Medias" , row.names(otus_centrales_tomate2[[2]]))
head(data_tomate_no_desarrollo)
```


#Otus centrales según submuestreos aleatorios 



```{r}
otus_tomate_aleatorio1 <- list()

for (i in 1:10){
  otus_tomate_aleatorio1[[i]] <- read.csv( paste0("../central_otus/otus_centrales_tomate_aleatorio1_" , as.character(i) , ".csv" ) , row.names = 1)
}
```

La cantidad de OTUs detectados como clave en los submuestreos aleaorios se encuentra en un rango similar a la de los OTUs detectados con todas las muestras y con la primera división no aleatoria. 

```{r}
taxa_tomate_aleatorio1 <- list()
numero_otus <- c()
for (i in 1:10){
  taxa_tomate_aleatorio1[[i]] <- rizosfera_bacterias[ intersect(row.names(rizosfera_bacterias), row.names(otus_tomate_aleatorio1[[i]])),]
  x_i <-  length(row.names(otus_tomate_aleatorio1[[i]]))
  print( paste0( "Se obtuvieron "  , as.character(x_i)  , " OTUs centrales en el submuestreo aleatorio " , as.character(i)  ) )
  numero_otus <- c(numero_otus , x_i)
}
print(paste0("Su media fue ", as.character(mean(numero_otus))))
print(paste0("Su mediana fue ", as.character(median(numero_otus))))
```

 

```{r}
nombres_familias <- c()
for (i in 1:10){
  nombres_familias <- union(nombres_familias ,as.vector(taxa_tomate_aleatorio1[[i]][, "V7"]))
  #print(unique(as.vector(taxa_centrales_tomate[[i]][, "Rank5"])))
}

nombres_familias <- union(nombres_familias , as.vector(taxa_centrales_tomate[[3]][,"V7"]))
print(nombres_familias)
```

```{r}
data_familias <- matrix( nrow = length(nombres_familias), ncol = 11 )


for (i in 2:11){
  for (j in 1:106) {
    if (is.element(nombres_familias[j], as.vector(taxa_tomate_aleatorio1[[i-1]][, "V7"] ))){
      data_familias[j,i] <- 1
    }else
    {
      data_familias[j,i] <- 0
    }
  }
}

for (j in 1:106) {
    if (is.element(nombres_familias[j], as.vector(taxa_centrales_tomate[[3]][, "V7"] ))){
      data_familias[j,1] <- 1
    }else
    {
      data_familias[j,1] <- 0
    }
}
data_familias <- data.frame(data_familias , row.names = nombres_familias )
colnames(data_familias) <- c("totales" , as.character(1:10) )
```

Acetobacteraceae y Pseudomonadaceae son las familias rescatadas en los 10 submuestreos aleatorios así como en el original. Burkholderiaceae solo no fue encontrado en uno de los analisis aleatorios. Enterobacteriaceae fue encontrado en 8 de los submuestreos aleatorios, pero no en el análisis original, aunque estaba presente en el de muestras de "desarrollo".
 

```{r}
upset(data_familias , nsets = 11 , keep.order = FALSE   )
```


```{r}
nombres_generos <- c()
for (i in 1:10){
  nombres_generos <- union(nombres_generos ,as.vector(taxa_tomate_aleatorio1[[i]][, "V8"]))
  #print(unique(as.vector(taxa_centrales_tomate[[i]][, "Rank5"])))
}

nombres_generos <- union(nombres_generos , as.vector(taxa_centrales_tomate[[3]][,"V8"]))
print(nombres_generos)
```

```{r}
data_generos <- matrix( nrow = length(nombres_generos), ncol = 11 )



for (i in 2:11){
  for (j in 1:188) {
    if (is.element(nombres_generos[j], as.vector(taxa_tomate_aleatorio1[[i-1]][, "V8"] ))){
      data_generos[j,i] <- 1
    }else
    {
      data_generos[j,i] <- 0
    }
  }
}

for (j in 1:188) {
    if (is.element(nombres_generos[j], as.vector(taxa_centrales_tomate[[3]][, "V8"] ))){
      data_generos[j,1] <- 1
    }else
    {
      data_generos[j,1] <- 0
    }
}9
data_generos <- data.frame(data_generos , row.names = nombres_generos )
colnames(data_generos) <- c("totales" , as.character(1:10) )
```

El género Pseudomonas fue considerado clave en cada uno de los submuestreos aleatorios. El genero Burkholderia aparecio en todos salvo uno de los analisis aleatorios. El género Komagataeibacter reapareció en 8 de los muestreos aleatorios y el original. Corynebacterium apareció en 9 de los análisis aleatorios sin aparecer en el original, aunque sí aparece en el análisis de muestras de desarrollo. 

```{r}
upset(data_generos , nsets = 11 , keep.order = TRUE   )
```


```{r}
nombres_especies <- c()
for (i in 1:10){
  nombres_especies <- union(nombres_especies ,as.vector(taxa_tomate_aleatorio1[[i]][, "V9"]))
  #print(unique(as.vector(taxa_centrales_tomate[[i]][, "Rank5"])))
}

nombres_especies <- union(nombres_especies , as.vector(taxa_centrales_tomate[[3]][,"V9"]))
print(nombres_especies)
```

```{r}
data_especies <- matrix( nrow = length(nombres_especies), ncol = 11 )



for (i in 2:11){
  for (j in 1:335) {
    if (is.element(nombres_especies[j], as.vector(taxa_tomate_aleatorio1[[i-1]][, "V9"] ))){
      data_especies[j,i] <- 1
    }else
    {
      data_especies[j,i] <- 0
    }
  }
}

for (j in 1:335) {
    if (is.element(nombres_especies[j], as.vector(taxa_centrales_tomate[[3]][, "V9"] ))){
      data_especies[j,1] <- 1
    }else
    {
      data_especies[j,1] <- 0
    }
}
data_especies <- data.frame(data_especies , row.names = nombres_especies )
colnames(data_especies) <- c("totales" , as.character(1:10) )
```

Del género Pseudomonas, la especie agaric fue encontrada como especie clave en todas las muestras, y fue encontrada en 4 de los submuetreos aleatorios. Del género Komagataeibacter, las dos especies clave más comunes entre los submuestreos aleatorios, Medellinensis y Europaeu, no aparecen en el análisis original. La especie clave del género Corynebacterium más común entre los submuestreos aleatorios fue glucoronolyticu, apareciendo en la mitad de ellos, aunque no en el análisis de las muestras de "desarrollo". 

```{r}
upset(data_especies , nsets = 11 , keep.order = TRUE   )
```





```{r}
for (i in 1:10){
  intersecion_i <- intersect(as.vector(taxa_tomate_aleatorio1[[i]][ , "V8"]) , as.vector(taxa_centrales_tomate[[3]][ , "V8"]  ) )
  print(paste0( "A nivel género hubo " , as.character( length(intersecion_i)) , " coincidencias entre los otus encontrados con todas las muestras y con el submuestreo aleatorio ", as.character(i) ))
}
```


```{r}
for (i in 1:10){
  intersecion_i <- intersect(as.vector(taxa_tomate_aleatorio1[[i]][ , "V9"]) , as.vector(taxa_centrales_tomate[[3]][ , "V9"]  ) )
  print(paste0( "A nivel especie´ hubo " , as.character( length(intersecion_i)) , " coincidencias entre los otus encontrados con todas las muestras y con el submuestreo aleatorio ", as.character(i) ))
}
```


